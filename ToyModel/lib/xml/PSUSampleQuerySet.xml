<?xml version="1.0"?>
 
<wdkModel name="RNAQueries">

<!--
<pageableQuerySet name="RNAPageableQueries">
   <pageableSqlQuery name="GeneCardName"
		     displayName="Gene Card name"
		     mainQueryRef="RNASimpleQueries.DTGeneCardName"
		     pageQueryRef="RNASimpleQueries.RNAListInDetail"/>

</pageableQuerySet>
-->

<simpleQuerySet name="RNASimpleQueries">

<!--
   <simpleSqlQuery name="DTGeneCardName"
            displayName="Gene Card name">

     <stringParam
       name="GeneName"
       prompt="Gene Name"
       sample="brca1"/>

     <sql>
       select distinct dbrn.na_sequence_id
       from sres.DBRef dbr, dots.DBRefNASequence dbrn 
       where dbr.lowercase_primary_identifier = '$$GeneName$$'
       and dbr.external_database_release_id = 4892
       and dbr.db_ref_id = dbrn.db_ref_id
     </sql>
  </simpleSqlQuery>

  <simpleSqlQuery name="RNAListInDetail"
            displayName="RNAs">

       <stringParam  name="resultTable"/>
       <stringParam  name="startRow"/>
       <stringParam  name="endRow"/>
    <sql>
      <![CDATA[
      select cd.gene_id, cd.taxon_name, cd.gene_symbol, 
             cd.gene_description, cd.na_sequence_id, cd.assembly_length, 
             cd.assembly_num_sequences, 
              cd.assembly_contains_mrna
      from allgenes.CentralDogma cd, $$resultTable$$ ids 
      where cd.na_sequence_id = ids.na_sequence_id
      and ids.i >= $$startRow$$
      and ids.i <= $$endRow$$
      order by cd.gene_id, cd.assembly_length desc
      ]]>
    </sql>
  </simpleSqlQuery>

  <simpleSqlQuery name="RNAByGoTerm"
            displayName="GO functional classification (by term)">

       <stringParam 
          name="GoTerm"
          prompt="Go Term"
          help="You know what it is"
          sample="GO:0001233"
          default="GO:"
          regex="GO:\d+"/>

       <sqlEnumParam
          name="Taxon"
          prompt="Organism"
          help="You know what it is"
          multipick="yes">
          <simpleSqlQuery>
            <sql>
              select name as key,
                     taxon_id as value
              from SRes.taxonName
              where name in ('mouse', 'human')
            </sql>
          </simpleSqlQuery>
       </sqlEnumParam>

    <sql>
      select distinct cd.na_sequence_id 
        from dots.GOAssociation ga, @ALLGENES_DB@.CentralDogma cd 
        where ga.go_term_id = $$GoTerm$$ 
        and ga.table_id = 180 
        and ga.row_id = cd.protein_id 
        and cd.taxon_id $$Taxon$$ 
        and ga.is_deprecated != 1 
        and ga.is_not != 1 
    </sql>

  </simpleSqlQuery>


   <simpleSqlQuery name="TaxonName"
            displayName="Taxon name">

     <stringParam
       name="TaxonId"
       prompt="Taxon Id"
       sample="8"
       regex="\d+"/>

     <sql>
       select name
       from SRes.TaxonName 
       where taxon_id = $$TaxonId$$
     </sql>
  </simpleSqlQuery>
-->




  <simpleSqlQuery name="RNAListInDetail"
            displayName="RNAs">

       <stringParam  name="resultTable"/>
       <stringParam  name="startRow"/>
       <stringParam  name="endRow"/>
    <sql>
select unique gf.na_feature_id,
       gf.subclass_view,
       gf.name,
       gf.gene_type,
       tn.name
from sres.TaxonName tn,
     dots.NASequence nas,
     dots.GeneFeature gf,
     $$resultTable$$ ids
where tn.name_class = 'scientific name'
      and gf.na_feature_id = ids.na_feature_id
      and gf.na_sequence_id = nas.na_sequence_id
      and nas.taxon_id = tn.taxon_id
      and ids.i &gt;= $$startRow$$
      and ids.i &lt;= $$endRow$$
    </sql>
  </simpleSqlQuery>

   <simpleSqlQuery name="CDSNumExons"
            displayName="CDS by number of exons">

     <stringParam
       name="Min"
       prompt="Min"
       sample="1"
       regex="\d+" />

     <stringParam
       name="Max"
       prompt="Max"
       sample="5"
       regex="\d+" />
       
     <sql>
select gf.na_feature_id, gf.name
from dots.GeneFeature gf
where gf.number_of_exons &gt;= '$$Min$$'
  and gf.number_of_exons &lt;= '$$Max$$'
     </sql>
  </simpleSqlQuery>

   <simpleSqlQuery name="CDSByName"
            displayName="CDS by systematic id">

     <stringParam
       name="Name"
       prompt="Name"
       sample="SPAC1701.1c"
       regex=".*" />
       
     <sql>
select gf.na_feature_id, gf.name
from dots.GeneFeature gf
where gf.name like '$$Name$$'
     </sql>
  </simpleSqlQuery>

   <simpleSqlQuery name="CDSByChromosome"
            displayName="CDS on a given chromosome">

       <sqlEnumParam
          name="Chromosome"
          prompt="Chromosome"
          help="You know what it is"
          multipick="no">
          <simpleSqlQuery>
            <sql>
select distinct ena.chromosome as key, ena.chromosome as value
from dots.ExternalNASequence ena
where ena.taxon_id = '130246'
            </sql>
          </simpleSqlQuery>
       </sqlEnumParam>
       
     <sql>
select gf.na_feature_id, gf.name
from dots.ExternalNASequence ena,
     dots.GeneFeature gf
where ena.taxon_id = '130246'
      and ena.chromosome = '$$Chromosome$$'
      and gf.na_sequence_id = ena.na_sequence_id
     </sql>
  </simpleSqlQuery>

</simpleQuerySet>
</wdkModel>


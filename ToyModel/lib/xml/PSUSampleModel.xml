<?xml version="1.0"?>
 
<wdkModel name="RNAModel">

  	<summarySet name="RNARecordLists">

     	<summary name="CDSNumExons"
        	        recordRef="RNARecords.CDSRecordWithExons"
                    queryRef="RNASimpleQueries.CDSNumExons" />

     	<summary name="CDSByName"
        	        recordRef="RNARecords.PSUCDSRecordByDbId"
                    queryRef="RNASimpleQueries.CDSByName" /> 

     	<summary name="CDSByChromosome"
        	        recordRef="RNARecords.PSUCDSRecordByDbId"
                    queryRef="RNASimpleQueries.CDSByChromosome" />
              
  	</summarySet>
  
  
    <recordSet name="RNARecords">

    <record name="PSUCDSRecordByDbId" type="CDS" idPrefix="">
      <attributeQuery twoPartName="RNARecordQueries.PSUCDSFieldsByDbId"/>

      <!-- <tableQuery twoPartName="RNARecordQueries.ExternalLinks"/> -->

      <textAttribute name="overview">
        <text>
          This is the CDS $$primaryKey$$.
        </text>
      </textAttribute>
    </record>
    
    <record name="PSUCDSRecordByName" type="CDS" idPrefix="">
      <attributeQuery twoPartName="RNARecordQueries.PSUCDSFieldsByName"/>

      <!-- <tableQuery twoPartName="RNARecordQueries.ExternalLinks"/> -->

      <textAttribute name="overview">
        <text>
          This is the CDS $$primaryKey$$.
        </text>
      </textAttribute>
    </record>

    <record name="CDSRecordWithExons" type="CDS" idPrefix="">
      <attributeQuery twoPartName="RNARecordQueries.CDSFieldsWithExons"/>

      <!-- <tableQuery twoPartName="RNARecordQueries.ExternalLinks"/> -->

      <textAttribute name="overview">
        <text>
          This is the CDS $$primaryKey$$.  It has $$number_of_exons$$ exon(s).
        </text>
      </textAttribute>
    </record>
  </recordSet>



  <querySet name="RNARecordQueries">

  <sqlQuery name="ExternalLinks">

    <paramRef  twoPartName="allparams.primaryKey"/>

    <column name="name" displayName="Database" />
    <column name="primary_identifier" displayName="Id" />
    <column name="secondary_identifier" displayName="Locus name" />
    <column name="chromosome" displayName="Chromosome" />
    <column name="centimorgans" displayName="cM" />
    <column name="external_database_release_id" />

    <sql>
      select ed.name,  dbr.primary_identifier, dbr.secondary_identifier, 
             dbr.chromosome, dbr.centimorgans,dbr.external_database_release_id 
      from dots.DBRefNASequence dbrn, sres.DBRef dbr, sres.ExternalDatabase ed,
           sres.ExternalDatabaseRelease edr 
       where dbrn.na_sequence_id = $$primaryKey$$ 
         and dbrn.db_ref_id = dbr.db_ref_id 
         and dbr.external_database_release_id = edr.external_database_release_id 
         and edr.external_database_id = ed.external_database_id
    </sql>
  </sqlQuery>


   <sqlQuery name="PSUCDSFieldsByDbId">

     <paramRef twoPartName="allparams.primaryKey"/>

     <column name="na_feature_id" displayName="na_feature_id" inSummary="true" />
     <column name="name" displayName="Name" inSummary="true" />
     <column name="gene_type" displayName="Gene Type" inSummary="true" />
     <column name="is_pseudo" displayName="Pseudo" />
     <column name="is_partial" displayName="Partial" />
     <column name="product" displayName="Product/Description" inSummary="true" />
     <column name="modification_date" displayName="Last modified" />

     <sql>
select gf.na_feature_id, 
       gf.name,
       gf.gene_type,
       gf.is_pseudo,
       gf.is_partial,
       gf.product, 
       TO_CHAR(gf.modification_date, 'Mon DD, YYYY HH:MI:SSAM') as modification_date
 from dots.GeneFeature gf
 where gf.na_feature_id = $$primaryKey$$
     </sql>
  </sqlQuery>


   <sqlQuery name="PSUCDSFieldsByName">

     <paramRef twoPartName="allparams.primaryKey"/>

     <column name="na_feature_id" displayName="na_feature_id" />
     <column name="name" displayName="Name"  inSummary="true" />
     <column name="gene_type" displayName="Gene Type" inSummary="true" />
     <column name="is_pseudo" displayName="Pseudo" />
     <column name="is_partial" displayName="Partial" />
     <column name="product" displayName="Product/Description" inSummary="true" />
     <column name="modification_date" displayName="Last modified" />

     <sql>
select gf.na_feature_id, 
       gf.name,
       gf.gene_type,
       gf.is_pseudo,
       gf.is_partial,
       gf.product, 
       TO_CHAR(gf.modification_date, 'Mon DD, YYYY HH:MI:SSAM') as modification_date
 from dots.GeneFeature gf
 where gf.name like '$$primaryKey$$'
     </sql>
  </sqlQuery>
   <sqlQuery name="CDSFieldsWithExons">

     <paramRef twoPartName="allparams.primaryKey"/>

     <column name="name" displayName="Name" />
     <column name="gene_type" displayName="Gene Type" />
     <column name="number_of_exons" displayName="No. of exons" />
     <column name="is_pseudo" displayName="Pseudo" />
     <column name="is_partial" displayName="Partial" />
     <column name="product" displayName="Product/Description" />
     <column name="modification_date" displayName="Last modified" />

     <sql>
select gf.name,
       gf.gene_type,
       gf.number_of_exons,
       gf.is_pseudo,
       gf.is_partial,
       gf.product, 
       TO_CHAR(gf.modification_date, 'Mon DD, YYYY HH:MI:SSAM') as modification_date
 from dots.GeneFeature gf
 where gf.na_feature_id = $$primaryKey$$
     </sql>
  </sqlQuery>

</querySet>





<querySet name="RNASimpleQueries">


   <sqlQuery name="CDSNumExons"
            displayName="CDS by number of exons">

     <paramRef twoPartName="allparams.Min" />

     <paramRef twoPartName="allparams.Max" />
       
     <column name="na_feature_id" />

     <sql>
select gf.na_feature_id
 from dots.GeneFeature gf
 where gf.number_of_exons &gt;= '$$Min$$'
  and gf.number_of_exons &lt;= '$$Max$$'
     </sql>
  </sqlQuery>

   <sqlQuery name="CDSByName"
            displayName="CDS by systematic id">

     <paramRef twoPartName="allparams.ByName" />
       
      <column name="na_feature_id" />

     <sql>
select gf.na_feature_id
 from dots.GeneFeature gf
 where gf.name like '$$ByName$$'
     </sql>
  </sqlQuery>

   <sqlQuery name="CDSByChromosome"
            displayName="CDS on a given chromosome">

       <paramRef twoPartName="allparams.Chromosome" />
       
       <column name="na_feature_id" />

     <sql>
select gf.na_feature_id
 from dots.ExternalNASequence ena,
     dots.GeneFeature gf
 where ena.taxon_id = '130246'
      and ena.chromosome = '$$Chromosome$$'
      and gf.na_sequence_id = ena.na_sequence_id
     </sql>
  </sqlQuery>


</querySet>

  <paramSet name="allparams">
  
    <stringParam name="primaryKey"/>
  
    <stringParam name="Min"
                 prompt="Min"
                 sample="1"
                 regex="\d+" />

    <stringParam name="Max"
                 prompt="Max"
                 sample="5"
                 regex="\d+" />
  
    <stringParam name="ByName"
                 prompt="Name"
                 sample="SPAC1701.1c"
                 substitute="true"
                 regex=".*" />
  
    <flatVocabParam name="Chromosome"
                    prompt="Chromosome"
                    help="You know what it is"
                    multipick="no"
                    queryRef="VocabQueries.Chromosome" />

  </paramSet>


  <querySet name="VocabQueries">
    <sqlQuery name="Chromosome">
      <column name="term" />
      <column name="internal" />
        <sql>
select distinct ena.chromosome as term, ena.chromosome as internal
  from dots.ExternalNASequence ena
  where ena.taxon_id = '130246'
        </sql>
    </sqlQuery>
  </querySet>


</wdkModel>


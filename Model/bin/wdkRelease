#!/bin/csh

if ($#argv < 2 || $#argv > 2) then
  echo
  echo "usage: wdkRelease target_full_path version"
  echo
  exit(-1)
endif

set TARGET_DIR=$1
set VERSION=$2

if (-d "$TARGET_DIR/$VERSION") then
  echo $TARGET_DIR/$VERSION already exists, remove first
  exit(-1)
endif

mkdir -p $TARGET_DIR/$VERSION

cd $TARGET_DIR/$VERSION

echo
echo branching WSF, WSFToy, WDK, and WDKToySite ...
svn copy -m "branching WSF for release $VERSION" \
    https://www.cbil.upenn.edu/svn/gus/WSF/trunk \
    https://www.cbil.upenn.edu/svn/gus/WSF/branches/$VERSION
svn copy -m "branching WSFToySite for release $VERSION" \
    https://www.cbil.upenn.edu/svn/gus/WSFToy/trunk \
    https://www.cbil.upenn.edu/svn/gus/WSFToy/branches/$VERSION
svn copy -m "branching WDK for release $VERSION" \
    https://www.cbil.upenn.edu/svn/gus/WDK/trunk \
    https://www.cbil.upenn.edu/svn/gus/WDK/branches/$VERSION
svn copy -m "branching WDKToySite for release $VERSION" \
    https://www.cbil.upenn.edu/svn/gus/WDKToySite/trunk \
    https://www.cbil.upenn.edu/svn/gus/WDKToySite/branches/$VERSION

echo
echo getting WSF, WSFToy, WDK, and WDKToySite from branched copy ...
svn co -q https://www.cbil.upenn.edu/svn/gus/WSF/branches/$VERSION WSF
if ($status != 0) then
  echo could not svn checkout $status
  exit(-1)
endif
svn co -q https://www.cbil.upenn.edu/svn/gus/WSFToy/branches/$VERSION WSFToy
if ($status != 0) then
  echo could not svn checkout $status
  exit(-1)
endif
svn co -q https://www.cbil.upenn.edu/svn/gus/WDK/branches/$VERSION WDK
if ($status != 0) then
  echo could not svn checkout $status
  exit(-1)
endif
svn co -q https://www.cbil.upenn.edu/svn/gus/WDKToySite/branches/$VERSION WDKToySite
if ($status != 0) then
  echo could not svn checkout $status
  exit(-1)
endif

echo
echo getting install ...
svn co -q https://www.cbil.upenn.edu/svn/gus/install/trunk install
if ($status != 0) then
  echo could not svn checkout $status
  exit(-1)
endif

echo
echo make ReleaseNotes.txt files ...
cat WDK/ReleaseNotes.txt WDKToySite/ReleaseNotes.txt >> ReleaseNotes.txt
cat WSF/ReleaseNotes.txt WSFToy/ReleaseNotes.txt >> wsfReleaseNotes.txt
  
echo 
echo pbckaging things up ...
rm -rf `find . -name '.svn'`
cp ReleaseNotes.txt ..
cp wsfReleaseNotes.txt ..
cd ..
tar -cvzf ${VERSION}.tar.gz $VERSION

rm -rf $VERSION

exit $?
  

